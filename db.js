const sqlite = require('sqlite3');

let db = new sqlite.Database('./db.sqlite', sqlite.OPEN_READWRITE, (e) => {
  if (e) {
    console.log("Error Occured", e);
  }
  else console.log("Sucessfully connected")
});

db.serialize(() => {
  db.run("CREATE TABLE IF NOT EXISTS users(id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,username TEXT NOT NULL UNIQUE, full_name TEXT, created_date TEXT, contact TEXT, active INTEGER NOT NULL)");
  db.run("CREATE TABLE IF NOT EXISTS blocked_user(id INTEGER PRIMARY KEY AUTOINCREMENT, uid INTEGER, created_date TEXT NOT NULL, blocked_for TEXT NOT NULL, ip TEXT NOT NULL, desc TEXT, FOREIGN KEY(uid) REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE)");
  db.run("CREATE TABLE IF NOT EXISTS login(id INTEGER PRIMARY KEY AUTOINCREMENT, uid INTEGER NOT NULL, email TEXT NOT NULL, password TEXT NOT NULL, mfa INTEGER NOT NULL, mfa_code TEXT,mfa_issued_at TEXT, FOREIGN KEY(uid) REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE)");
  db.run("CREATE TABLE IF NOT EXISTS products(id INTEGER PRIMARY KEY AUTOINCREMENT, uid INTEGER NOT NULL, title TEXT NOT NULL, price REAL NOT NULL, location_type TEXT, location TEXT, created_date TEXT NOT NULL, active INTEGER NOT NULL DEFAULT 1, status TEXT NOT NULL, category TEXT NOT NULL, other_info TEXT, FOREIGN KEY(uid) REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE)");
  db.run("CREATE TABLE IF NOT EXISTS review(id INTEGER PRIMARY KEY AUTOINCREMENT, uid INTEGER NOT NULL, pid INTEGER NOT NULL, comment TEXT NOT NULL, created_date TEXT NOT NULL, FOREIGN KEY(pid) REFERENCES products(id) ON UPDATE CASCADE ON DELETE CASCADE, FOREIGN KEY(uid) REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE)");
  db.run("CREATE TABLE IF NOT EXISTS user_fav(id INTEGER PRIMARY KEY AUTOINCREMENT, uid INTEGER NOT NULL, pid INTEGER NOT NULL, FOREIGN KEY(pid) REFERENCES products(id) ON UPDATE CASCADE ON DELETE CASCADE, FOREIGN KEY(uid) REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE)");
  db.run("CREATE TABLE IF NOT EXISTS user_fav(id INTEGER PRIMARY KEY AUTOINCREMENT, uid INTEGER NOT NULL, pid INTEGER NOT NULL, FOREIGN KEY(pid) REFERENCES products(id) ON UPDATE CASCADE ON DELETE CASCADE, FOREIGN KEY(uid) REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE)");
}
);
db.close();